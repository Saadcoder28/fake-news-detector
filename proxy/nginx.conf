worker_processes 1;

events { worker_connections 1024; }

http {
    include       mime.types;
    default_type  application/octet-stream;

    gzip on;
    gzip_static on;
    gzip_types application/javascript text/css;

    upstream backend {                      # ← keeps the service name in one place
        server fake-news-api:8000;          # docker‑compose service (or change to `api:8000`)
    }

    server {
        listen 80;

        # ── static React bundle ───────────────────────────
        location / {
            root /usr/share/nginx/html;
            try_files $uri $uri/ /index.html;
        }

        # ── API passthroughs ─────────────────────────────
        location /predict        { proxy_pass http://backend; }
        location /batch_predict  { proxy_pass http://backend; }

        # NEW ↴ live‑stats & explanation routes
        location /stats          { proxy_pass http://backend; }
        location /explain/       { proxy_pass http://backend; }  # note trailing slash
        location /health         { proxy_pass http://backend; }
    }
}
